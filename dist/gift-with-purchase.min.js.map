{"version":3,"file":"gift-with-purchase.min.js","sources":["../src/gift-with-purchase.js"],"sourcesContent":["import './gift-with-purchase.scss';\n\n/**\n * Gift With Purchase Component - automatically adds/removes gift when cart threshold is met\n * Emits gwp:added/gwp:removed/gwp:error events and broadcasts cart updates\n */\nclass GiftWithPurchase extends HTMLElement {\n\t#threshold = 0;\n\t#currentAmount = 0;\n\t#variantId = null;\n\t#isActive = false;\n\t#isAdded = false;\n\t#promoEnded = false;\n\t#productAvailable = true;\n\t#isDisabled = false;\n\t#cartPanel = null;\n\t#handlers = {};\n\t#debounceTimer = null;\n\t#attachRetryTimer = null;\n\t#isMutating = false; // prevents overlapping cart mutations\n\t#pendingCart = null; // stores cart snapshot during mutation for recheck\n\t#messageAbove = null;\n\t#messageBelow = null;\n\t#moneyFormat = null;\n\n\tstatic get observedAttributes() {\n\t\treturn [\n\t\t\t'threshold',\n\t\t\t'current',\n\t\t\t'variant-id',\n\t\t\t'promo-ended',\n\t\t\t'product-available',\n\t\t\t'message-above',\n\t\t\t'message-below',\n\t\t\t'money-format',\n\t\t];\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tconst _ = this;\n\t\t_.#threshold = parseFloat(_.getAttribute('threshold')) || 0;\n\t\t_.#currentAmount = parseFloat(_.getAttribute('current')) || 0;\n\t\t_.#variantId = _.getAttribute('variant-id');\n\t\t_.#promoEnded = _.hasAttribute('promo-ended');\n\t\t_.#productAvailable = _.#parseBooleanValue(_.getAttribute('product-available'), true);\n\t\t_.#messageAbove = _.getAttribute('message-above');\n\t\t_.#messageBelow = _.getAttribute('message-below');\n\t\t_.#moneyFormat = _.getAttribute('money-format');\n\t\t_.#handlers = { cartDataChange: _.#handleCartDataChange.bind(_) };\n\t}\n\n\tconnectedCallback() {\n\t\tconst _ = this;\n\n\t\t_.#calculateInitialState();\n\t\t_.#render();\n\t\t_.#updateVisualState();\n\t\t_.#attachListeners();\n\t}\n\n\t#calculateInitialState() {\n\t\tconst _ = this;\n\t\t// Calculate initial active state based on attributes (before any cart events)\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\t_.#isDisabled = _.#promoEnded || !_.#productAvailable;\n\t\t_.#isActive = _.#currentAmount >= convertedThreshold && !_.#isDisabled;\n\t}\n\n\tdisconnectedCallback() {\n\t\tconst _ = this;\n\t\tif (_.#debounceTimer) clearTimeout(_.#debounceTimer);\n\t\tif (_.#attachRetryTimer) clearTimeout(_.#attachRetryTimer);\n\t\tif (_.#cartPanel) _.#cartPanel.removeEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t}\n\n\tattributeChangedCallback(name, oldValue, newValue) {\n\t\tconst _ = this;\n\t\tif (oldValue === newValue) return;\n\n\t\tswitch (name) {\n\t\t\tcase 'threshold':\n\t\t\t\t_.#threshold = parseFloat(newValue) || 0;\n\t\t\t\tbreak;\n\t\t\tcase 'current':\n\t\t\t\t_.#currentAmount = parseFloat(newValue) || 0;\n\t\t\t\tbreak;\n\t\t\tcase 'variant-id':\n\t\t\t\t_.#variantId = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'promo-ended':\n\t\t\t\t_.#promoEnded = newValue !== null;\n\t\t\t\tbreak;\n\t\t\tcase 'product-available':\n\t\t\t\t_.#productAvailable = _.#parseBooleanValue(newValue, true);\n\t\t\t\tbreak;\n\t\t\tcase 'message-above':\n\t\t\t\t_.#messageAbove = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'message-below':\n\t\t\t\t_.#messageBelow = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'money-format':\n\t\t\t\t_.#moneyFormat = newValue;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Recalculate state and update UI if component is connected\n\t\tif (_.isConnected) {\n\t\t\t_.#calculateInitialState();\n\t\t\t_.#updateVisualState();\n\t\t\t_.#updateMessages();\n\t\t}\n\t}\n\n\t#render() {\n\t\tthis.classList.add('gift-with-purchase');\n\t\tthis.#renderMessages();\n\t}\n\n\t#renderMessages() {\n\t\t// Look for existing message element with data-content-gwp-message\n\t\tthis.#updateMessages();\n\t}\n\n\t#formatMoney(amount) {\n\t\tif (!this.#moneyFormat) return amount.toFixed(2).replace(/\\.00$/, '');\n\n\t\tconst amountFixed = amount.toFixed(2);\n\t\tconst amountNoDecimals = Math.round(amount).toString();\n\t\tconst amountWithComma = amountFixed.replace('.', ',');\n\t\tconst amountNoDecimalsWithComma = amountNoDecimals.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n\t\treturn this.#moneyFormat\n\t\t\t.replace(/\\{\\{\\s*amount_no_decimals_with_comma_separator\\s*\\}\\}/g, amountNoDecimalsWithComma)\n\t\t\t.replace(/\\{\\{\\s*amount_with_comma_separator\\s*\\}\\}/g, amountWithComma)\n\t\t\t.replace(/\\{\\{\\s*amount_no_decimals\\s*\\}\\}/g, amountNoDecimals)\n\t\t\t.replace(/\\{\\{\\s*amount\\s*\\}\\}/g, amountFixed);\n\t}\n\n\t#getConvertedThreshold() {\n\t\t// Convert threshold using Shopify currency rate if available (for multi-currency stores)\n\t\tconst rate = parseFloat(window.Shopify?.currency?.rate) || 1;\n\t\treturn this.#threshold * rate;\n\t}\n\n\t#parseBooleanValue(value, defaultValue = true) {\n\t\tif (value === null || typeof value === 'undefined') return defaultValue;\n\t\tif (value === '') return true;\n\t\tconst normalized = String(value).trim().toLowerCase();\n\t\tif (normalized === 'false' || normalized === '0') return false;\n\t\tif (normalized === 'true' || normalized === '1') return true;\n\t\treturn defaultValue;\n\t}\n\n\t#updateMessages() {\n\t\tconst _ = this;\n\t\tconst messageEl = _.querySelector('[data-content-gwp-message]');\n\t\tif (!messageEl) return;\n\n\t\tlet message = '';\n\t\tif (_.#isActive && _.#messageAbove) {\n\t\t\tmessage = _.#messageAbove;\n\t\t} else if (!_.#isActive && _.#messageBelow) {\n\t\t\tconst remaining = _.#getConvertedThreshold() - _.#currentAmount;\n\t\t\tconst formattedAmount = _.#formatMoney(remaining);\n\t\t\tmessage = _.#messageBelow\n\t\t\t\t.replace(/\\[\\s*amount\\s*\\]/g, formattedAmount)\n\t\t\t\t.replace(/\\[amount\\]/g, formattedAmount);\n\t\t}\n\n\t\tmessageEl.textContent = message;\n\t\tmessageEl.style.display = message ? 'block' : 'none';\n\t}\n\n\t#attachListeners() {\n\t\tconst _ = this;\n\t\t_.#cartPanel = _.closest('cart-panel');\n\n\t\tif (_.#cartPanel) {\n\t\t\t_.#cartPanel.addEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t\t} else {\n\t\t\t_.#attachRetryTimer = setTimeout(() => {\n\t\t\t\t_.#attachRetryTimer = null;\n\t\t\t\t_.#cartPanel = _.closest('cart-panel');\n\t\t\t\tif (_.#cartPanel) _.#cartPanel.addEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t\t\t\telse console.error('GWP - cart-panel still not found after delay');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\t#handleCartDataChange(event) {\n\t\tconst _ = this;\n\t\tconst cart = event.detail;\n\t\tif (!cart || typeof cart.calculated_subtotal === 'undefined') return;\n\t\tif (_.#debounceTimer) clearTimeout(_.#debounceTimer);\n\n\t\t_.#debounceTimer = setTimeout(() => {\n\t\t\t_.#debounceTimer = null;\n\t\t\t_.#currentAmount = parseFloat(cart.calculated_subtotal / 100) || 0;\n\t\t\t_.#checkGiftInCart(cart);\n\t\t\t_.#updateState(cart);\n\t\t}, 300);\n\t}\n\n\t#checkGiftInCart(cart) {\n\t\tconst _ = this;\n\t\tconst giftLines = _.#getGiftLines(cart, true);\n\t\t_.#isAdded = giftLines.length > 0;\n\t}\n\n\t#getGiftLines(cart, matchVariantId = true) {\n\t\tconst _ = this;\n\t\tif (!cart?.items) return [];\n\t\treturn cart.items.filter((item) => {\n\t\t\tif (item.properties?._gwp_item !== 'true') return false;\n\t\t\tif (!matchVariantId) return true;\n\t\t\tif (!_.#variantId) return false;\n\t\t\treturn item.variant_id?.toString() === _.#variantId.toString();\n\t\t});\n\t}\n\n\t#recheckIfPending() {\n\t\tconst _ = this;\n\t\tif (_.#pendingCart) {\n\t\t\tconst cart = _.#pendingCart;\n\t\t\t_.#pendingCart = null;\n\t\t\t_.#checkGiftInCart(cart);\n\t\t\t_.#updateState(cart);\n\t\t}\n\t}\n\n\t#updateState(cart) {\n\t\tconst _ = this;\n\n\t\t// If mutation in progress, queue this cart for recheck later\n\t\tif (_.#isMutating) {\n\t\t\t_.#pendingCart = cart;\n\t\t\treturn;\n\t\t}\n\n\t\tconst wasActive = _.#isActive;\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\t_.#isDisabled = _.#promoEnded || !_.#productAvailable;\n\t\t_.#isActive = _.#currentAmount >= convertedThreshold && !_.#isDisabled;\n\n\t\tif (_.#isDisabled) _.#removeAllGiftsFromCart(cart);\n\t\telse if (_.#isActive && !wasActive && !_.#isAdded && _.#variantId) _.#addGiftToCart();\n\t\telse if (!_.#isActive && _.#isAdded && _.#variantId) _.#removeGiftFromCart(cart);\n\n\t\t_.#updateVisualState();\n\t\t_.#updateMessages();\n\t}\n\n\t#updateVisualState() {\n\t\tconst _ = this;\n\t\tif (_.#promoEnded) {\n\t\t\t_.setAttribute('state', 'ended');\n\t\t\t_.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\tif (!_.#productAvailable) {\n\t\t\t_.setAttribute('state', 'disabled');\n\t\t\t_.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\t_.style.display = '';\n\t\tif (_.#isAdded) _.setAttribute('state', 'added');\n\t\telse if (_.#isActive) _.setAttribute('state', 'active');\n\t\telse _.setAttribute('state', 'inactive');\n\t}\n\n\tasync #addGiftToCart() {\n\t\tconst _ = this;\n\t\t_.#isMutating = true;\n\t\ttry {\n\t\t\tconst res = await fetch('/cart/add.js', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\titems: [{ id: _.#variantId, quantity: 1, properties: { _gwp_item: 'true', _hide_in_cart: 'true', _ignore_price_in_subtotal: 'true' } }],\n\t\t\t\t}),\n\t\t\t});\n\t\t\tif (!res.ok) throw new Error(`http ${res.status}`);\n\t\t\tawait res.json();\n\t\t\t_.#isAdded = true;\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:added', { detail: { variantId: _.#variantId }, bubbles: true }));\n\t\t\t_.#cartPanel?.getCartAndRefresh();\n\t\t} catch (err) {\n\t\t\tconsole.error('giftwithpurchase: add error', err);\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:error', { detail: { action: 'add', error: err.message }, bubbles: true }));\n\t\t} finally {\n\t\t\t_.#isMutating = false;\n\t\t\t_.#recheckIfPending();\n\t\t}\n\t}\n\n\tasync #removeGiftFromCart(cart) {\n\t\tconst _ = this;\n\t\tif (!cart?.items) return;\n\n\t\tconst giftLines = _.#getGiftLines(cart, true);\n\t\tif (!giftLines.length) {\n\t\t\t_.#isAdded = false;\n\t\t\treturn;\n\t\t}\n\n\t\t_.#isMutating = true;\n\t\ttry {\n\t\t\tawait _.#removeAllGiftItems(giftLines);\n\t\t} finally {\n\t\t\t_.#isMutating = false;\n\t\t\t_.#recheckIfPending();\n\t\t}\n\t}\n\n\tasync #removeAllGiftsFromCart(cart) {\n\t\tconst _ = this;\n\t\tif (!cart?.items) return;\n\n\t\tconst giftLines = _.#getGiftLines(cart, false);\n\t\tif (!giftLines.length) {\n\t\t\t_.#isAdded = false;\n\t\t\treturn;\n\t\t}\n\n\t\t_.#isMutating = true;\n\t\ttry {\n\t\t\tawait _.#removeAllGiftItems(giftLines);\n\t\t} finally {\n\t\t\t_.#isMutating = false;\n\t\t\t_.#recheckIfPending();\n\t\t}\n\t}\n\n\tasync #removeAllGiftItems(giftLines) {\n\t\tconst _ = this;\n\t\ttry {\n\t\t\tawait Promise.all(\n\t\t\t\tgiftLines.map(async (item) => {\n\t\t\t\t\tconst res = await fetch('/cart/change.js', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tcredentials: 'same-origin',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },\n\t\t\t\t\t\tbody: JSON.stringify({ id: item.key, quantity: 0 }),\n\t\t\t\t\t});\n\t\t\t\t\tif (!res.ok) throw new Error(`http ${res.status}`);\n\t\t\t\t})\n\t\t\t);\n\t\t\t_.#isAdded = false;\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:removed', { detail: { variantId: _.#variantId }, bubbles: true }));\n\t\t\t_.#cartPanel?.getCartAndRefresh();\n\t\t} catch (err) {\n\t\t\tconsole.error('giftwithpurchase: bulk remove error', err);\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:error', { detail: { action: 'remove', error: err.message }, bubbles: true }));\n\t\t}\n\t}\n\n\tgetState() {\n\t\tconst _ = this;\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\treturn {\n\t\t\tcurrentAmount: _.#currentAmount,\n\t\t\tthreshold: _.#threshold,\n\t\t\tconvertedThreshold,\n\t\t\tvariantId: _.#variantId,\n\t\t\tisActive: _.#isActive,\n\t\t\tisAdded: _.#isAdded,\n\t\t\tpromoEnded: _.#promoEnded,\n\t\t\tproductAvailable: _.#productAvailable,\n\t\t\tisDisabled: _.#isDisabled,\n\t\t\tremainingAmount: Math.max(0, convertedThreshold - _.#currentAmount),\n\t\t\tcurrencyRate: parseFloat(window.Shopify?.currency?.rate) || 1,\n\t\t};\n\t}\n\n\tget currentAmount() {\n\t\treturn this.#currentAmount;\n\t}\n\tget threshold() {\n\t\treturn this.#threshold;\n\t}\n\tget variantId() {\n\t\treturn this.#variantId;\n\t}\n\tget isActive() {\n\t\treturn this.#isActive;\n\t}\n\tget isAdded() {\n\t\treturn this.#isAdded;\n\t}\n\tget promoEnded() {\n\t\treturn this.#promoEnded;\n\t}\n\tget productAvailable() {\n\t\treturn this.#productAvailable;\n\t}\n\tget isDisabled() {\n\t\treturn this.#isDisabled;\n\t}\n\n\tsetCurrentAmount(amount) {\n\t\tconst _ = this;\n\t\t_.#currentAmount = parseFloat(amount) || 0;\n\t\t_.#updateState({ items: [] });\n\t\t_.#updateMessages();\n\t}\n\n\tsetThreshold(threshold) {\n\t\tconst _ = this;\n\t\t_.#threshold = parseFloat(threshold) || 0;\n\t\t_.#updateState({ items: [] });\n\t\t_.#updateMessages();\n\t}\n\n\tsetVariantId(variantId) {\n\t\tthis.#variantId = variantId;\n\t}\n}\n\nif (!customElements.get('gift-with-purchase')) {\n\tcustomElements.define('gift-with-purchase', GiftWithPurchase);\n}\n\nexport { GiftWithPurchase };\n"],"names":["GiftWithPurchase","HTMLElement","threshold","currentAmount","variantId","isActive","isAdded","promoEnded","productAvailable","isDisabled","cartPanel","handlers","debounceTimer","attachRetryTimer","isMutating","pendingCart","messageAbove","messageBelow","moneyFormat","observedAttributes","constructor","super","_","this","parseFloat","getAttribute","hasAttribute","parseBooleanValue","cartDataChange","handleCartDataChange","bind","connectedCallback","calculateInitialState","render","updateVisualState","attachListeners","convertedThreshold","getConvertedThreshold","disconnectedCallback","clearTimeout","removeEventListener","attributeChangedCallback","name","oldValue","newValue","isConnected","updateMessages","classList","add","renderMessages","formatMoney","amount","toFixed","replace","amountFixed","amountNoDecimals","Math","round","toString","amountWithComma","amountNoDecimalsWithComma","rate","window","Shopify","currency","value","defaultValue","normalized","String","trim","toLowerCase","messageEl","querySelector","message","remaining","formattedAmount","textContent","style","display","closest","addEventListener","setTimeout","console","error","event","cart","detail","calculated_subtotal","checkGiftInCart","updateState","giftLines","getGiftLines","length","matchVariantId","items","filter","item","properties","_gwp_item","variant_id","recheckIfPending","wasActive","removeAllGiftsFromCart","addGiftToCart","removeGiftFromCart","setAttribute","res","fetch","method","credentials","headers","body","JSON","stringify","id","quantity","_hide_in_cart","_ignore_price_in_subtotal","ok","Error","status","json","dispatchEvent","CustomEvent","bubbles","getCartAndRefresh","err","action","removeAllGiftItems","Promise","all","map","async","key","getState","remainingAmount","max","currencyRate","setCurrentAmount","setThreshold","setVariantId","customElements","get","define"],"mappings":"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"}