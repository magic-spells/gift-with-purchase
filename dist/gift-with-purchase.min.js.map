{"version":3,"file":"gift-with-purchase.min.js","sources":["../src/gift-with-purchase.js"],"sourcesContent":["import './gift-with-purchase.scss';\n\n/**\n * Gift With Purchase Component - automatically adds/removes gift when cart threshold is met\n * Emits gwp:added/gwp:removed/gwp:error events and broadcasts cart updates\n */\nclass GiftWithPurchase extends HTMLElement {\n\t#threshold = 0;\n\t#currentAmount = 0;\n\t#variantId = null;\n\t#isActive = false;\n\t#isAdded = false;\n\t#promoEnded = false;\n\t#cartPanel = null;\n\t#handlers = {}; // pre-bound listener refs for clean-up\n\t#debounceTimer = null;\n\t#attachRetryTimer = null;\n\t#messageAbove = null;\n\t#messageBelow = null;\n\t#moneyFormat = null;\n\n\tstatic get observedAttributes() {\n\t\treturn [\n\t\t\t'threshold',\n\t\t\t'current',\n\t\t\t'variant-id',\n\t\t\t'promo-ended',\n\t\t\t'message-above',\n\t\t\t'message-below',\n\t\t\t'money-format',\n\t\t];\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tconst _ = this;\n\t\t_.#threshold = parseFloat(_.getAttribute('threshold')) || 0;\n\t\t_.#currentAmount = parseFloat(_.getAttribute('current')) || 0;\n\t\t_.#variantId = _.getAttribute('variant-id');\n\t\t_.#promoEnded = _.hasAttribute('promo-ended');\n\t\t_.#messageAbove = _.getAttribute('message-above');\n\t\t_.#messageBelow = _.getAttribute('message-below');\n\t\t_.#moneyFormat = _.getAttribute('money-format');\n\t\t_.#handlers = { cartDataChange: _.#handleCartDataChange.bind(_) };\n\t}\n\n\tconnectedCallback() {\n\t\tconst _ = this;\n\n\t\t_.#calculateInitialState();\n\t\t_.#render();\n\t\t_.#updateVisualState();\n\t\t_.#attachListeners();\n\t}\n\n\t#calculateInitialState() {\n\t\tconst _ = this;\n\t\t// Calculate initial active state based on attributes (before any cart events)\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\t_.#isActive = _.#currentAmount >= convertedThreshold && !_.#promoEnded;\n\t}\n\n\tdisconnectedCallback() {\n\t\tconst _ = this;\n\t\tif (_.#debounceTimer) clearTimeout(_.#debounceTimer);\n\t\tif (_.#attachRetryTimer) clearTimeout(_.#attachRetryTimer);\n\t\tif (_.#cartPanel) _.#cartPanel.removeEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t}\n\n\tattributeChangedCallback(name, oldValue, newValue) {\n\t\tconst _ = this;\n\t\tif (oldValue === newValue) return;\n\n\t\tswitch (name) {\n\t\t\tcase 'threshold':\n\t\t\t\t_.#threshold = parseFloat(newValue) || 0;\n\t\t\t\tbreak;\n\t\t\tcase 'current':\n\t\t\t\t_.#currentAmount = parseFloat(newValue) || 0;\n\t\t\t\tbreak;\n\t\t\tcase 'variant-id':\n\t\t\t\t_.#variantId = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'promo-ended':\n\t\t\t\t_.#promoEnded = newValue !== null;\n\t\t\t\tbreak;\n\t\t\tcase 'message-above':\n\t\t\t\t_.#messageAbove = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'message-below':\n\t\t\t\t_.#messageBelow = newValue;\n\t\t\t\tbreak;\n\t\t\tcase 'money-format':\n\t\t\t\t_.#moneyFormat = newValue;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Recalculate state and update UI if component is connected\n\t\tif (_.isConnected) {\n\t\t\t_.#calculateInitialState();\n\t\t\t_.#updateVisualState();\n\t\t\t_.#updateMessages();\n\t\t}\n\t}\n\n\t#render() {\n\t\tthis.classList.add('gift-with-purchase');\n\t\tthis.#renderMessages();\n\t}\n\n\t#renderMessages() {\n\t\t// Look for existing message element with data-content-gwp-message\n\t\tthis.#updateMessages();\n\t}\n\n\t#formatMoney(amount) {\n\t\tif (!this.#moneyFormat) return amount.toFixed(2).replace(/\\.00$/, '');\n\n\t\tconst amountFixed = amount.toFixed(2);\n\t\tconst amountNoDecimals = Math.round(amount).toString();\n\t\tconst amountWithComma = amountFixed.replace('.', ',');\n\t\tconst amountNoDecimalsWithComma = amountNoDecimals.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n\t\treturn this.#moneyFormat\n\t\t\t.replace(/\\{\\{\\s*amount_no_decimals_with_comma_separator\\s*\\}\\}/g, amountNoDecimalsWithComma)\n\t\t\t.replace(/\\{\\{\\s*amount_with_comma_separator\\s*\\}\\}/g, amountWithComma)\n\t\t\t.replace(/\\{\\{\\s*amount_no_decimals\\s*\\}\\}/g, amountNoDecimals)\n\t\t\t.replace(/\\{\\{\\s*amount\\s*\\}\\}/g, amountFixed);\n\t}\n\n\t#getConvertedThreshold() {\n\t\t// Convert threshold using Shopify currency rate if available (for multi-currency stores)\n\t\tconst rate = parseFloat(window.Shopify?.currency?.rate) || 1;\n\t\treturn this.#threshold * rate;\n\t}\n\n\t#updateMessages() {\n\t\tconst _ = this;\n\t\tconst messageEl = _.querySelector('[data-content-gwp-message]');\n\t\tif (!messageEl) return;\n\n\t\tlet message = '';\n\t\tif (_.#isActive && _.#messageAbove) {\n\t\t\tmessage = _.#messageAbove;\n\t\t} else if (!_.#isActive && _.#messageBelow) {\n\t\t\tconst remaining = _.#getConvertedThreshold() - _.#currentAmount;\n\t\t\tconst formattedAmount = _.#formatMoney(remaining);\n\t\t\tmessage = _.#messageBelow\n\t\t\t\t.replace(/\\[\\s*amount\\s*\\]/g, formattedAmount)\n\t\t\t\t.replace(/\\[amount\\]/g, formattedAmount);\n\t\t}\n\n\t\tmessageEl.textContent = message;\n\t\tmessageEl.style.display = message ? 'block' : 'none';\n\t}\n\n\t#attachListeners() {\n\t\tconst _ = this;\n\t\t_.#cartPanel = _.closest('cart-panel');\n\n\t\tif (_.#cartPanel) {\n\t\t\t_.#cartPanel.addEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t\t} else {\n\t\t\t_.#attachRetryTimer = setTimeout(() => {\n\t\t\t\t_.#attachRetryTimer = null;\n\t\t\t\t_.#cartPanel = _.closest('cart-panel');\n\t\t\t\tif (_.#cartPanel) _.#cartPanel.addEventListener('cart-panel:data-changed', _.#handlers.cartDataChange);\n\t\t\t\telse console.error('GWP - cart-panel still not found after delay');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\t#handleCartDataChange(event) {\n\t\tconst _ = this;\n\t\tconst cart = event.detail;\n\t\tif (!cart || typeof cart.calculated_subtotal === 'undefined') return;\n\t\tif (_.#debounceTimer) clearTimeout(_.#debounceTimer);\n\n\t\t_.#debounceTimer = setTimeout(() => {\n\t\t\t_.#debounceTimer = null;\n\t\t\t_.#currentAmount = parseFloat(cart.calculated_subtotal / 100) || 0;\n\t\t\t_.#checkGiftInCart(cart);\n\t\t\t_.#updateState(cart);\n\t\t}, 300);\n\t}\n\n\t#checkGiftInCart(cart) {\n\t\tconst _ = this;\n\t\tif (!cart.items || !_.#variantId) {\n\t\t\t_.#isAdded = false;\n\t\t\treturn;\n\t\t}\n\t\tconst giftLines = cart.items.filter(\n\t\t\t(item) => item.variant_id.toString() === _.#variantId.toString() && item.properties?._gwp_item === 'true'\n\t\t);\n\t\t_.#isAdded = giftLines.length > 0;\n\t}\n\n\t#updateState(cart) {\n\t\tconst _ = this;\n\t\tconst wasActive = _.#isActive;\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\t_.#isActive = _.#currentAmount >= convertedThreshold && !_.#promoEnded;\n\n\t\tif (_.#promoEnded) _.#removeGiftFromCart(cart);\n\n\t\tif (_.#isActive && !wasActive && !_.#isAdded && _.#variantId) {\n\t\t\t_.#addGiftToCart();\n\t\t} else if (!_.#isActive && _.#isAdded && _.#variantId) {\n\t\t\t_.#removeGiftFromCart(cart);\n\t\t}\n\n\t\t_.#updateVisualState();\n\t\t_.#updateMessages();\n\t}\n\n\t#updateVisualState() {\n\t\tconst _ = this;\n\t\tif (_.#promoEnded) {\n\t\t\t_.setAttribute('state', 'ended');\n\t\t\t_.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\t_.style.display = '';\n\t\tif (_.#isAdded) _.setAttribute('state', 'added');\n\t\telse if (_.#isActive) _.setAttribute('state', 'active');\n\t\telse _.setAttribute('state', 'inactive');\n\t}\n\n\tasync #addGiftToCart() {\n\t\tconst _ = this;\n\t\ttry {\n\t\t\tconst res = await fetch('/cart/add.js', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\titems: [{ id: _.#variantId, quantity: 1, properties: { _gwp_item: 'true', _hide_in_cart: 'true', _ignore_price_in_subtotal: 'true' } }],\n\t\t\t\t}),\n\t\t\t});\n\t\t\tif (!res.ok) throw new Error(`http ${res.status}`);\n\t\t\tawait res.json();\n\t\t\t_.#isAdded = true;\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:added', { detail: { variantId: _.#variantId }, bubbles: true }));\n\t\t\t_.#cartPanel?.getCartAndRefresh();\n\t\t} catch (err) {\n\t\t\tconsole.error('giftwithpurchase: add error', err);\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:error', { detail: { action: 'add', error: err.message }, bubbles: true }));\n\t\t}\n\t}\n\n\tasync #removeGiftFromCart(cart) {\n\t\tconst _ = this;\n\t\tif (!cart?.items) return;\n\n\t\ttry {\n\t\t\tconst giftLines = cart.items.filter(\n\t\t\t\t(item) => item.variant_id.toString() === _.#variantId.toString() && item.properties?._gwp_item === 'true'\n\t\t\t);\n\t\t\tif (!giftLines.length) {\n\t\t\t\t_.#isAdded = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait _.#removeAllGiftItems(giftLines);\n\t\t} catch (err) {\n\t\t\tconsole.error('giftwithpurchase: remove error', err);\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:error', { detail: { action: 'remove', error: err.message }, bubbles: true }));\n\t\t}\n\t}\n\n\tasync #removeAllGiftItems(giftLines) {\n\t\tconst _ = this;\n\t\ttry {\n\t\t\tawait Promise.all(\n\t\t\t\tgiftLines.map(async (item) => {\n\t\t\t\t\tconst res = await fetch('/cart/change.js', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tcredentials: 'same-origin',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },\n\t\t\t\t\t\tbody: JSON.stringify({ id: item.key, quantity: 0 }),\n\t\t\t\t\t});\n\t\t\t\t\tif (!res.ok) throw new Error(`http ${res.status}`);\n\t\t\t\t})\n\t\t\t);\n\t\t\t_.#isAdded = false;\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:removed', { detail: { variantId: _.#variantId }, bubbles: true }));\n\t\t\t_.#cartPanel?.getCartAndRefresh();\n\t\t} catch (err) {\n\t\t\tconsole.error('giftwithpurchase: bulk remove error', err);\n\t\t\t_.dispatchEvent(new CustomEvent('gwp:error', { detail: { action: 'remove', error: err.message }, bubbles: true }));\n\t\t}\n\t}\n\n\tgetState() {\n\t\tconst _ = this;\n\t\tconst convertedThreshold = _.#getConvertedThreshold();\n\t\treturn {\n\t\t\tcurrentAmount: _.#currentAmount,\n\t\t\tthreshold: _.#threshold,\n\t\t\tconvertedThreshold,\n\t\t\tvariantId: _.#variantId,\n\t\t\tisActive: _.#isActive,\n\t\t\tisAdded: _.#isAdded,\n\t\t\tpromoEnded: _.#promoEnded,\n\t\t\tremainingAmount: Math.max(0, convertedThreshold - _.#currentAmount),\n\t\t\tcurrencyRate: parseFloat(window.Shopify?.currency?.rate) || 1,\n\t\t};\n\t}\n\n\tget currentAmount() {\n\t\treturn this.#currentAmount;\n\t}\n\tget threshold() {\n\t\treturn this.#threshold;\n\t}\n\tget variantId() {\n\t\treturn this.#variantId;\n\t}\n\tget isActive() {\n\t\treturn this.#isActive;\n\t}\n\tget isAdded() {\n\t\treturn this.#isAdded;\n\t}\n\tget promoEnded() {\n\t\treturn this.#promoEnded;\n\t}\n\n\tsetCurrentAmount(amount) {\n\t\tconst _ = this;\n\t\t_.#currentAmount = parseFloat(amount) || 0;\n\t\t_.#updateState({ items: [] });\n\t\t_.#updateMessages();\n\t}\n\n\tsetThreshold(threshold) {\n\t\tconst _ = this;\n\t\t_.#threshold = parseFloat(threshold) || 0;\n\t\t_.#updateState({ items: [] });\n\t\t_.#updateMessages();\n\t}\n\n\tsetVariantId(variantId) {\n\t\tthis.#variantId = variantId;\n\t}\n}\n\nif (!customElements.get('gift-with-purchase')) {\n\tcustomElements.define('gift-with-purchase', GiftWithPurchase);\n}\n\nexport { GiftWithPurchase };\n"],"names":["GiftWithPurchase","HTMLElement","threshold","currentAmount","variantId","isActive","isAdded","promoEnded","cartPanel","handlers","debounceTimer","attachRetryTimer","messageAbove","messageBelow","moneyFormat","observedAttributes","constructor","super","_","this","parseFloat","getAttribute","hasAttribute","cartDataChange","handleCartDataChange","bind","connectedCallback","calculateInitialState","render","updateVisualState","attachListeners","convertedThreshold","getConvertedThreshold","disconnectedCallback","clearTimeout","removeEventListener","attributeChangedCallback","name","oldValue","newValue","isConnected","updateMessages","classList","add","renderMessages","formatMoney","amount","toFixed","replace","amountFixed","amountNoDecimals","Math","round","toString","amountWithComma","amountNoDecimalsWithComma","rate","window","Shopify","currency","messageEl","querySelector","message","remaining","formattedAmount","textContent","style","display","closest","addEventListener","setTimeout","console","error","event","cart","detail","calculated_subtotal","checkGiftInCart","updateState","items","giftLines","filter","item","variant_id","properties","_gwp_item","length","wasActive","removeGiftFromCart","addGiftToCart","setAttribute","res","fetch","method","credentials","headers","body","JSON","stringify","id","quantity","_hide_in_cart","_ignore_price_in_subtotal","ok","Error","status","json","dispatchEvent","CustomEvent","bubbles","getCartAndRefresh","err","action","removeAllGiftItems","Promise","all","map","async","key","getState","remainingAmount","max","currencyRate","setCurrentAmount","setThreshold","setVariantId","customElements","get","define"],"mappings":"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"}